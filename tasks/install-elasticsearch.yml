---
#
- name: prepare elasticsearch group
  group: name=elasticsearch state=present

- name: prepare elasticsearch user
  user: name=elasticsearch group=elasticsearch

- name: prepare elasticsearch directories
  file:
    path: "{{ item }}"
    state: directory
    owner: "elasticsearch"
    group: "elasticsearch"
  with_items:
    - "{{ elasticsearch_home }}"
    - "{{ elasticsearch_data }}"
    - "{{ elasticsearch_logs }}"

- name: define repo
  template:
    src: elasticsearch-yum.repo.j2
    dest: "/etc/yum.repos.d/elasticsearch-{{ elasticsearch_major }}.x.repo"

- name: import elastic key
  rpm_key: state=present key=https://packages.elastic.co/GPG-KEY-elasticsearch

- name: install elasticsearch
  yum: name=elasticsearch state=present

- name: enable elasticsearch service
  service: name=elasticsearch enabled=yes
